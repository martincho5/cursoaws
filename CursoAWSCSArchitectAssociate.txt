Apuntes AWS
Regions - Cluster of DataCenters
AWS - Availability Zones
Min 2, Medio 3, Max 6. (2a - AZ letter)
Alta conectividad entre cada AZ

IAM is Global, no Region Selection (like Billing)

Root Account should never be used (and shared)
User
Groups
Roles for Machines or AWS resources
Policies write in JSON - Agrupa los 3 UGR

MFA - IAM - managed Policites
User minimal amount - Lease privilege principles
IAM Federation - Como AD / SAML
IAM por persona
Un Role para Aplicación
IAM credentials no deben compartirse
IAM credential nunca escribir en codigo.
ROOT account solo para setuo inicial - nunca usar root IAM Credentials.
-------------
EC2 - VM
EBS - Storage de VMs
ELB - Load Balancing across VMs
ASG - AutoScalling Group
AMI - Amazon Machine Image
For Certification use Amazon Linux 2 - es lo nuevo
Network - es un VPC y la Subnet es en que Availability Zone va a ir
Security Group - Firewall
Tiene Rules de Inbound and Outbound
Para multiples Instancias en un SG.
Los Security Group son por Region/VPC. Se tiene que crear por región

1 SG solo para el acceso SSH

- EC2
 - Stop
 - Reboot
 - Terminate (no quiero nada más - se borra)
EC2 Instance Connect - Conectarme a la instancia desde un navegador.
Default user ec2-user
Linux chmod 0400 keyname - Cambiarlo
ssh -i EC2Tutorial.pem ec2-user@18.221.68.113
Poner solo el usuario y sacar la herencia.
Mi usuario full access.
Connection Timeout - SG problem
EC2 instance connect solo funciona con AMI 2 de Linux

Si da time out --- es un problema de Security Groups
Si da Connection refused --- error de aplicacion o no fue lanzada la app

Un SG puede autorizar a otro SG.
-----------
Private vs Public IP.
Elastic IPs - es una IP fija para el EC2 para una sola instancia.
5 Elastic IP en toda la cuenta - 
Evitar el uso de Elastic IP - Usar mejor un DNS.
O usar un Load Balancer.
---------------------
EC2 User Data Script - Corre con root
Cuando realiza el primer booteo
Cuando se crea la instancia en Configure Instance Details
Advanced Details
Está User Data
Se escribre - As Text
Primero el bin
Corre con el comando sudo
-------
- On Demand - Se paga por lo que usar. Solo prendida. Es la más cara. Para elastic Workload
- Reserved:
  - Reserved - 75% discount / Pay upfront from 1 or 3 years (Like Database)
  - Convertible Reserved Instances - Puede cambiarse el EC2 Instance Type - 54%
  - Scheduled Reserved Instances - Launch within time window you reserve / Fraction of day/Week/month
- Spot Instances: discount upto to 90% compared to On-Demand
  - Las instancias pueden perderse en cualquier momento del tiempo si el max price is less than the current spot price. 
  - The MOST cost-efficient instances in AWS
  - Para - Batch Jobs, Data analysis, image processing. Que se pueda
  No para Databajes or un Job Critical.
  Combo - Reserved Instance for baseline + On-Demand & Spot for peaks.
- Dedicated Instances: (Van en examen)
  HW dedicated to you
  Share HW with instances in same account
  No control over instalnce placement
- Dedicated Hosts:
  Full Control, visibilidad del socket.
  Por 3 años y physical dedicated EC2
  BYOL - More expensive
------------------
EC2 Spot Instance
 - max spot price mientras el precion se menor
 Spot Block
 - 1 to 6 hours - Se tiene ese bloque sin interrupciones. (para Batchs)
Spot Request
- Max price
- Number of instances
- Launch specification
- Request type: one-time | persistent
- Valid from, Valid until
Cancelar un Spot Request no termina la instancia. 
1ero - Cancelar el Spot Request y después terminar las spot instance asociadas.
Spot Fleets
 - Spot Fleets = set of Spot Instances + (optional) On-Demand Instances
 - The Spot Fleet will try to meet the target capacity with price constrains
 - Definir los launch pools tipo de instancia, OS, Availability Zone
 - Se pueden tener multiples launch pools para que Fleet pueda elegir
 - Spot Fleets deja de lanzar instancias cuando llega a las capacidad o al costo máximo
 Estrategias
  - LowestPrice: Del pool que tenga el precio más bajo (optimización de costos, trabajos cortos)
  - diversified: distributed a través de todos los pools (para Availability y trabajos largos)
  - CapacityOptimized: capacidad óptoma para el número de instancias.
Spot Fleets permite solicitar spot instance de forma automática con el precio más bajo.
--------------------
EC2 - Instance Type
R:Aplicación que necesitan RAM - in memory caches
C:aplicacion para CPU
M:aplicanciones balanced
I:aplicaciones que son buenas en I/O
G:aplicaciones que necesitan Group

T2/T3:burstable instances (up to a capacity).
T2/T3: unlimited burst.

T2/T3 - Cuando está funcionando igual
      - burst credits, el CPU se vuelve terrible.
      - Son buena para un pico de vez en cuando, pero es por crédito de burst.
      - Si la máquina deja de burstear, los creditos se acumulan en el tiempo.
T2/T3 unlimited burst
  - Desde Nov 2017
--------------------------------
AMI
 - Para Linux o Windows
 - Pre installed packages
 - Viene con monitoreo
 - Con Seguridad
 - Instalar AD
 - Instalar apps
 - optimización
 - AMI es solo para una región específica
Public AMI
 - Se pueden compar
AMI Storage
 - Vive en un Amazon S3
 - Las AMI son private 
AMI Pricing
 - Van el el Storage S3
 - Remover los AMIs que no usamos
Se puede compartir las AMI con otra cuenta de AWS
Compartir la AMI no afecta el ownership de la AMI
Si copias una AMI compartida, sos el dueño de la nueva AMI
Para copiar la AMI compartida conmigo, me tiene que dar el dueño de la AMI, permisos de lectura sobre el almacenamiento donde está la AMI, EBS Snapshot o el bucker de S3.
Limitaciones
No se puede copiar una AMI encriptada.
No se pueden copiar AMI que tengan asociadas un billingProduct code. Incluye Windows AMIs y AMIs from AWS Marketplace
Para Copiar una share AMI con billing product, se lanza una instancia EC2 en mi cuenta usando la AMI compartida y luego creamos una AMI de esa instancia.
---------------------
Placemente Groups
 - Se quiere tener control de donde quedan las instancias de EC2
 - 3 Strategies
   . Cluster - cluster instances en un grupo de baja latencia en una sola Availability Zone
   . Spread - spread las instacias entre diferente hardware con un máximo de 7 instacias por grupo de AZ) - Para aplicaciones críticas.
   . Partition - spread instances en diferentes particiones (en diferentes racks) en una AZ. Hasta 100s de EC2 instance (Hadoop,Cassandra,Kafka)
 - Cluster
   Están en el mismo Rack y el mismo AZ
    Pros: Great network - 10 Gbps
    Cons: Si el rack falla, todas las instancias fallan al mismo tiempo.
    Use Case: Big Data Job/App con low latency y high network.
 - Spread
   Todas en diferentes HW
    Pros: Van en diferentes AZ, Reduce el riesgo de falla, EC2 en diferente HW
    Cons: Hasta 7 instancias por AZ por placemente group.
 - Partition
   Cada particion, son diferentes racks
    Pros: Hasta 7 particiones por AZ, Hasta 100s of EC2 instances, La instancia de una particion no comparte el rack con otra particion, Si falla una partición afecta a varias EC2, EC2 accede a la metadata de la partition.
    Use casds: HDFS, Cassandra, Kafka

ENI (Elastic Network Interfaces)
 - Representa a una Virtual Network Card 
   Puede tener - One Elastic IP
   Private IPv4.
 - Se pueden crear ENI indepdendintes y atachar on the 
 - Bound to specific AZ.
 - Eth0 no puede ser detachada
EC2 Hinernate
 - Stop: la Data en el disco sigue intacto.
 - Terminate: borra todo
 - Hibernate: La data en la Ram se preserva. Bootea más rápido. Se baja la ram en un root EBS volume
   Servicios que toman mucho tiempo en volver a insta
   Hibernate solo soportado por C3,C4,C5,M3,M4,M5,R3,R4 y R5 (CMR)
   RAM menos de 150 Gb.
   No soportado para bare Metal 
   AMI: Linux 2, Linux AMI, Ubuntu y Windows
   RootVolume debe ser EBS encriptado
   Solo para On-Demand y Reserved instance (no para Spot)
   No más de 60 días.
........
EC2 for solutions architects
 - EC2 son facturadas por segundo, t2.micro es free
 - En Linux/Mac ssh y windows putty
 - SSH port 22 y solo a mi IP
 - Timeout issues - Problema de Security Group
 - Permission issues on the SSH key - run chmod 0400
 - Security Groups pueden referenciar a otros security groups en vez de rangos de IPs
 - Diferencias entre Private, Public y Elastic IP
 - EC2 User data
 - 4 EC2 launch modes:
   - On Demand
   - Reserved - Por 1 años a 3 años
   - Spot instances - Se pueden apagar
   - Dedicated Hosts - Licence restricted.
 - Basic instances (R,C,M,I,G,T2/T3)
 - Create AMIs faster booteo
 - AMI puede copiarse entre regiones y cuentas
 - EC2 - Placement Groups: Cluster / Spread.
##################################################33
High Availability and Scalability
- Scalability es que una aplicación puede soportar grandes cargas adaptandose
  2 tipos: Scalability Vertical y Horizontal (elasticity)
Vertical Scalability
 - Increase a size of a instance. paso de t2.micro a t2.large.
   Para sistemas no distribuidos como Bases de Datos, RDS, ElastiCache. Limite de Hw.
Horizontal Scalability
 - Aumentar el número de instancias
 - Es para sistemas distribuidos, muy común en apps web y modern apps.
High Availability
 - Correr tu aplicacion o sistemas en al menos 2 datacentes - Availability Zone
 - Para que siga corriendo en caso de caida de un DC.
 EC2 - Vertical Scaling: t2.nano vs u-12tbl.emtal
     - Horizontal Scaling: Auto Scaling Group, Load Balancer
     - High Availability: Auto Scaling Group multi AZ, Load Balancer multi AZ.

Load Balancing
 - Forward internet traffic to multiple servers
 - Spread Load
 - Expose a single point of access DNS to appl
 - Seamlesly handle failures of downstream instances
 - Do regular health checks
 - Provide SSL Termination for websites
 - Enforce stickiness with cookies
 - HA across zones
 - Separate pulbic traffic from private traffic
 ELB (EC2 Load Balancer)
  - AWS guarantess that it wil be working
  - AWS takes care of upgrade, maintenance, ha
  - AWS provides only a few configuration knobs
  - It costs less
  - integrate with many AWS
Health checks every 5 seconds
  - Verifica que la instancia esté disponible y contestando los requests
  - El health check se hace sobre un puerto y una ruta (/health generalmente)
  - Si no es 200 (OK) la instancia la deja unhealth
3 Tipos de Load Balancer on AWS
 - Classic Load Balancer (v1 - old generation) - 2009
   HTTP, HTTPS y TCP
 - Application Load Balancer (v2 - new generation) - 2016
   HTTP, HTTPS, WebSocket
 - Network Load Balancer (v2 - new generation) - 2017
   TCP, TLS (secure TCP) & UDP
Recomendado utilizar los v2 generation
2 Tipos, internal (private) o external (pulbic)
Load Balancer Security Groups
 - Ponemos una App Security group que solo permitimos el acceso del Load Balancer al servidor EC2
El más seguro.
LB (Load Balancer) cosas a saber
 - LBs pueden escalar pero no instantaneamente
 - Troubleshooting
   - 4xx errores de cliente
   - 5xx errores de aplicacion
   - 503 problema de capacidad o no hay targets registrados
 - Monitoring
  - ELB tiene un access log para todos los accesos
  - CloudWatch Metric da estadísticas agregadas.
Classic
 - Soporta TCP (Layer 4), HTTP y HTTPS (Layer 7)
 - Health Checks TCP o HTTP
 - Fixed hostname -
Application LB
 - Appl y Layer 7 (HTTP)
 - Load balancing to multiple http apps across machines (target group)
 - Load balancing to multiple app on the same machine (Containers)
 - Support HTTP/2 and WebSocket
 - Suppor redicts from HTTP to HTTPs
 - Routing tables to different targent groups:
   - Routing base on path in URL
   - Routing based on hostname in URL
   - Routing based on Query String, Headers.

   ALB son muy bueno para micro servicios y applicaciones de contenedores
   Port mapping feature to redirect to a dinamic port
   En comparación, necesitamos multiples CLB por aplicación.
 Target Groups
  - EC2 instances (managed by auto scaling group) - HTTP
  - ECS tasks - HTTP
  - Lambda functions - HTTP request is translated into a JSON
  - IP Addresses

Good to know
 - Fixed hostname (xxx.region.elb.amazonaws.com)
 - The app server don't see the IP of teh cleint direct
   - inserted in the header X-Forwarded-For
   - Para el puerto X-Forwarded-Port y el proto (X-Forearded-Proto)
NLB - Network Load Balancer
- Es Layer 4:
  - Forward TCP & UDP Traffic to you instances.
  - Maneja millones de request por segundo
  - Menos de 100 ms de latencia (en ALB son 400 ms)
- NLB tien una IP estática por AZ, y soporta la asignación de Elastic IP
  - Para extrem performance o TCP o UDP
  - No está incluido en EC2 free tier.
Load Balancer stickiness
 - Same client to same instance.
 - Trabaja con Clasic Load Balancers y Application Load Balancer.
   La cookie tiene un día de expiración que uno controla.
   Se usa para que el usuario no pierda sus datos de session
   Trae un imbalance, puede que una EC2 mayor carga que otras.
   Se configura en el ALB en el target group
Cross-Zone Load Balancing
 - Cada Load Balancer está distribuido a través de todas las instancias registrada en todas las AZ.
 Sin Cross-Zone se tiene un NLB en cada zona.
 En Classic Load Balancer
  - Disabled by Default
  - No charges for inter AZ data si es tá habilidado
 En Application Load Balancer
  - Siempre activo
  - No charge for inter AZ data
 En Network Load Balancer
  - Disabled by Default
  - Pay Charges for inter AZ
Elastic Load Balancer
SSL/TLS - Basics
  - SSL - in-flight encryption - Secure Sockets Layer
  - TLS sin los usados pero se los llama SSL
  - Public SSL are issued by CA.
  - Deben renovarse
  - El Load Balancer usa los X.509 certificate.
  - Se pueden administrar los certificados usando ACM (AWS Certificate Manager)
  - Se puede subir nuestro certificado.
  - HTTPS Listener:
    - Especificar el certificado por defecto
    - Agregar una lista opcional de certs para soportar multiples dominios
    - Clientes puede usar SNI (Server Name Indication) para especificar el hostaname
    - Especificar security policy para soportar versiones viejas de SSL/TLS
  SSL - Server Name Infication
   - SNI solves the problema of loading multiple SSL certificates onto one web server (para servir multiples websites)
   - El cliente infica el hostname del servidore de destino en el handshake inicial de SSL
   - El servidor encuentra el certificado correcto o devuelve el default.
   - Solo funciona con ALB & NLB, CloudFront
   - No funciona con CLB
  CLB - Solo 1 certificado SSL / se usan multiples CLB para multiples hostnames.
  ALB v2 - Multiple listeners with multiple SSL certificates / usa SNI
  NLB v2 - Multiple listeners with multiple SSL certificates / usa SNI
Connection Draining
 - CLB: Connection Draining
 - Target Group: Deregistration Delay (ALB & NLB)
   - Es el tiempo para completar las requests que tiene mientras la instancia es de-registrada o unhealthy
   - Stop sending new requests porque se está de-registering
  Espera para finalizar la conección por default 300 sec y se puede customizar entre 1 y 3600 sec.
   Pude deshabilitarse si el valor es 0.
Auto Scaling Group (ASG)
 - Sirve para 
   - Scale out (agregar instancias EC2) para incrementar la carga
   - Scale in (remover instancias EC2) para bajar la carga.
   - Decrecer o incremente hasta un máximo.
   - Automatically regsitrar nuevas intancias en el load balancer.
 - Desired Capacity - Actual Size.
    - Scale out - agrega instancias / Scale in - remuve instancias
 - Atributos del ASGs.
   - Configuración de inicio:
      - AMI + Tipo de instancia
      - EC2 user data
      - EBS volumes
      - Security Groups
      - SSH Key Pair
   - Min / Max / initial capacity
   - Network + Subnets
   - Load Balancer Information
   - Scaling Policies
 - Alarms
  - Se puede escalar basado en alarmas de CloudWatch
  - Se pueden crear
 - New Rules
  - Es posible definir mejores reglas de auto scaling en EC2
    - Average CPU Usage
    - Number of requests on the ELB per instance.
    - Promedio de trafico de red entrente
    - Promedio de trafico de red saliente
  - Son fáciles para setup
  - Custom Metric (ASG)
    - Se puede auto escalar basado en métricas propieas.
      Enviar metricas customizadas desde la aplicación en EC2 al cloud watcht
      Crear una alarama de CloudWathc
      Usar el CloudWatch alarm para sacar e scaling policy
  - ASG use launch configuration or Launch Templates
  - Para actualizar loa ASG, hay que proveer una nueva configuración
  - IAM roles atachados en una ASG son asignados a la instancia de EC2
  - ASG es gratis. Se paga por otros recursos que son lancazdos
  - Ha
 ----
En el AutoScalling Group tenemos el launch template es el nuevo y configuration es la versión viejas
Launch Template permite spot y configuration un solo tipo de máquina
Auto Scaling Groups - Scaling Policies
Target Tracking Scaling
 - Most simple and easy to set-up
Simple/ Step scaling
 - When a CloudWatch alarm is triggered (example C PU > 70%), entonces agregá 2 unidades
 - When a CloudWatch alarm is triggeres then remove si pasa algo, remover 1 unidades
Scheduled Actions
 - Anticipate a scaling based on know usage patterns
 - En un horario especifico se sube la capacidad mínima
Scaling Cooldown
 - The cooldown period ayuda a asegurar que el auto scaling group no lance y termine instancias adicionales antes que tome efecto la actividad previa.
 - Se puede crear para simple scaling policy.
 - override el default cooldown period.
 - El default cooldown es de 300 segundos, se puede bajar a 180 segundos.
LifeCycle Hooks
Pending: Wait to Pending:Proceed para verificar cosas.
Terminating:Wait to terminating:Proceedr para extraer cosas antes de bajarla.

Diferencias entre Launch template vs Launch configuration
 - Launch Configuration (legacy) se recrea cada vez que se cambiarse
 - Launch Template (newer) Puede tener multiples versiones, crear parametrops y usar on-demand and spot intances o un mix de ambas.
 - Usar el T2 y recomended by AWS going forward.
-----------------------------
EBS volume
EBS (Elastic Block Storage) Volume es un drive de red que se puede atachar a una instania que está corriendo.
Los datos persisten.
 - Es un network drive. Puede haber latencia.
 - Se puede desatacher a una instancia y atachar a otr rápidamente
 - Solo puede ser usado en el AZ que fue creado, no se puede attachar a otro AZ
 - Se puede mover entre AZ, pero hay que hacer un snapshot.
 - Cuando se crea pide el tamaño y los IOPS necesarios - Se cobra por la capacidad entera, no por el uso.
 - Se puede incrementar la capacidad hacia adelante. Empezar chiquito.
EBS volumen 4 tipos:
 - GP2 (SSD) - SSD de proposito general para variadas cargas
 - IO1 (SSD) - Alta performance, mission critical low-latency
 - ST1 (HDD) - Bajo costo para acceso frecuente. carga intensiva
 - SC1 (HDD) - Bajo costo diseñado para baja carga
Son caracterizados por Tamañano, Thoughput, IPOS 
Solo los GP2 y IO1 pueden ser usados como boot volumes.
EBS - Volume Types Use Cases
 - GP" - de 1 Gb a 16 Tb      

--------------------------
Tipos de Volumenes EBS
GP2
 - Recomendado para la mayoria de los Worloads
 - Para boot del sistema
 - Para VDI
 - Aplicaciones con baja latencia
 - Ambientes de Desarrollo y Test.
 - De 1 GB a 16 TB 
 - Pequeños GP2 pueden llegar a un pico de IOPS de 3000
 - Max IOPS 16.000, pero se dan 3 IOPs por GB eso quiere decir que cuando tengamos 5.334 GB estamos en el máximo de IOPS
 El burst para que se tenga en cuenta tiene que ser el tamaño menor a 1000 GB
 Si tengo un tamaño de 16384 las IPS son 16.000 poque es mayor a 5333 GB.
IO1
 - Para aplicaciones críticas, más de 16000 IOPS por Volumen
 - Para Bases de Datos Grandes - Mongo, Cassandra, MS SQL, MySQL, Postgres, Oracle
 - De 4 a 16 TB
 - IOPS is provisioned (PIOPS) - Min 1000 Max 64000 (nitro instances) para el resto 32.000 el máximo.
   El máximo ratio de PIOPS es de 50:1
ST1
 - Para Streaming workloads con fast throughput a bajo precio
 - Big Data, Data Warehouse, Log processing
 - Apache Kafka
 - No puede ser boot
 - De 500 Gb a 16 TB
 - Max IOPS es 500 / throughput máximo 500 MiB/s
SC1
 - Volumenes grandes que no son accedidos con frecuencia
 - Escenarios donde el costo de almacenamiento sea bajo
 - No pude ser booteable
 - de 500 Gb a 16 TB
 - Max IOPs is 250
 - Max throughput 250 MiB/s
Resumen
 - GP2 - General Purpose (cheap)
 - IO1 - Provisioned IOPS (expensive)
 - st1 - Throughput Optimized HDD
 - sc1 - Cool HDD

EBS Snapshots
 - Incremental - solo los bloques que se cambian
 - EBS backups usan IO con lo cual no hay que realizarlo cuando hay mucho tráfico en la aplicación
 - Son grabados en S3
 - No es necesario detachar el volumen para hacer snapshot, pero se recomiendo
 - Máximo de 100.000 Snapshots
 - Se pueden copiar Snapshots entre AZ o regiones
 - Se pueden hacer AMI de un Snapshot
 - Un volumen restaurado de un snapshot debe ser pre-warmed (usando fio o dd para leer todo el volumen)
 - Se pueden automatizar con Amazon Data Lifecycle Manager.
EBS Migration
 - EBS volume solo en su AZ
 - Para migrarlo, Snapshot, copya el volumen a otra región diferente, crear un volumen del snapshot en la Az que elegimos.
EBS Encription
 - Data at rest es encriptada en el volumen
 - Todo los datos on the fly entre la instancia y el volumen están encriptados
 - Todos los snapshots están encriptados.
 - Todos los creados del snapshot tambíen están encriptados.
 La encripción y desencripción se maneja en forma transparente.
 Encryption tiene un impacto mínimo en la latencia
 EBS encription key KMS (AES-256)
 Copiar un snapshot desencritado, permite encriptarlo
Encriptar un EBS no encriptado.
 - Crear un EBS de un snapshot del Volumen.
 - Encriptar el EBS Snapshot (usando copy)
 - Crear un nuevo EBS volume del snapshot (el volumen va a estar encriptado)
 - Atachar el volumen encriptado a la instancia original.
Diferencias entre EBS vs Instance Store
 - Algunas instancias no vienen con Root EBS volume
 - Instance store está atachado físicamente a la máquina
 - Pros - Better I/O, Good for buffer, cache, scractch data / Data sobrevive al reboot.
 - Cons: Con el Stop o Termination, El instance store se pierde. No se puede agrandar on the fly. Los backups los tiene que hacer el usuario
Local EC2 Instance Store
 - Very High IOPS
 - Disk Attached to physical server
 - Hasta 7,5 Tb.
 - Es un Block Storage (Como el EBS)
 - No se puede incrementar el tamaño.
 - Riesgo de que los datos se pierdan si el hw falla.
EBS RAID Options
 - EBS se replica en el AZ.
 - Si queremos llegar a 100.000 IOPS?
 - Mirror porque no confio en EBS.
 - RAID es posible si tu SO lo soporta.
 - RAID 0 y 1 OK
 - RAID 5 y 6 no recomendados para EBS.
 RAID 0 y RAID 1
 - RAID 0 incrementa la performance.
 - Si un disco falla, los datos se pierden.
 - Discos Grandes con muchos IOPS.
 - RAID 1 para fault tolerance
 - Se escribe en ambos al mismo tiempo.
 - 2x network - Mejor el throughput .
EFS Overview
 - Elastic File System
   - Managed NFS que puede ser montado en varios EC2.
   - EFS trabaja con EC2 en Multiples AZ.
   - Alta disponibilidad, escalable, caro (sale 3x gp2), se paga por uso.
   - Casos de uso: Content Managment, web serving, data sharing, Wordpress
   - NFSv4.1 protocol
   - Security Group para controlar el acceso al EFS.
   - Compatible con Linux base AMI (not windows)
   - Encription at rest
   - Para POSIX File systemas standard file API
   - File system scala automáticamente, no es necesario un capacity planning
 - EFS Scale
   - 1000s of concurrent NFS client, 10 GB+/s throughput
   - Grow hasta petabytes automaticamente.
 - EFS performance mode (se especifica cuando se crea)
   - Proposito general: sensible a la latencia (web server)
   - Max I/O - higher latency (big data, media processing)
 - Storage Tiers (Lifecycle Managment feature - moveing files after N days)
   - standard - Frequently access files
   - Infrequent access (EFS-IA): costo mayor para leer archivos, baja el precio de almacenamiento.
EBS vs EFS
 - EBS Volume
   - attach a un instancia por vez.
   - Solo en 1 AZ
   - Para migrarlo, tomar snapshot, restaurar el snapshot en otro AZ
   - Root EBS se terminan cuando se termina una instancia ECs (se puede deshabilitar)
 - EFS 
   - Mounting 100s of instances across AZ.
   - EFS share website files
   - Only Linux
   - EFS-IA para bajar el costo.
   - Por uso se paga.
######################################
AWS RDS
 - RDS - Relational Database Service
 - Es una DB manejada para DBs que usan SQL query language.
 - Creadas DBs en la nube
   - Postgres, MySQL, MariaDB, Oracle, MS SQL, Aurora
 RDS vs EC2 instance.
  - RDS es una servicio administrado:
     - Provisionamiento automático, patching OS
     - Continous backups and restore
     - Dashboard de monitoreo
     - Lectura de réplicas para mejorar la performance de lectura
     - Muti AZ for DR (Dissaster Recovery)
     - Ventanas de mantenimiento para upgrades
     - Capacidad de escalar (vertical y Horizontal)
     - almacenamiento por EBS (gp2 o IO1)
     But you can't ssh into your instances.
  - RDS backups
     - Soy activados en forma automática
     - Daily full backup
     - Transaction logs backup cada 5 minutos
     - 7 days retention by default (se puede incrementar a 35 días)
     DB snapshots
      - Ejecutados en forma manual por el usuario.
      - Los backup por lo más largo que uno quiera.
 RDS Read Replicas for read Scalability
  - Se pueden crear hasta 5 Replicas de Lectura
  - Entre las misma AZ, Cross AZ o Cross Region.
  - Replica Asincronica para que las lecturas sean eventualmente consistentes.
  - Las replicas puede promoverse como DB owner.
  - La aplicación hay que cambiarla el connection string para que la lecturas vayan a las replicas.
 RDS Read Replicas - Use Cases
  - Queremos realizar Reportes y algo de analítica.
  - Creamos una replica de lectura y los reportes los busca ahí.
  - En una Read Replica solo soporta SELECT.
 RDS Read Replicas - Network cost
  - En AWS hay un costo de red cuando se va de una Az a otra Az.
  - Para ahorar puedo tener la replica en la misma Az. No tiene costo en la misma Az.
 RDS Multi AZ (Disaster Recovery)
  - Sync replication en AZ B - En standby.
  - One DNS name - Failover automático
  - Sirve en caso de Falla de AZ, perdida de red, instancio o falla de almacenamiento.
  - No hay que hacer intervención en las apps.
  - No es para scaling, está en standby.
  - Las Read Replicas pueden setearse como Multi Az for DR.
 RDS Security - Encryption
  - At Rest Encryption
    - Encripta el master y la replica con AWS KMS - AES-256
    - Se define la encripción en el momento del inicio.
    - Si el master no está encriptado, la réplica tampoco puede.
    - Trasparent Data Encryption (TDE) disponible para Oracle y SQL Server.
  - In-flight encryption
    - Certificados SSL para encriptar datos a RDS in flight.
    - Brinda SSL con certificados de confianza cuando se conecta a la base de datos.
    - Para forzar SSL:
       - PostgresSQL: rds.force_ssl=1 en AWS RDS Console
       - En MySQL, en la DB: GRANT USE ON *.* TO 'mysqlyser'@'%' REQUIRE SSL;
  - RDS Encryption Operations
    - Encriptad backups
      - Snapshot de una base no encriptada, no está encriptado.
      - Snapshot de una base encriptada, encripta los mismos.
      - Se puede copiar un snapshot en uno encriptado.
    - Como encriptar una RDS database no encriptada:
      - Se crea un snapshot de la bd
      - Copiamos y lo tenemos encriptado.
      - Restauramos la base de datos encriptada del snapshot
      - Migramos las Apps a la nueva base de datos y borramos la vieja.
  - RDS Security - Netwrok & IAM
    - Network Security
      - RDS en un private subnet.
      - RDS le deja la seguridad a los security groups (Como EC2)
    - Access Management
      - IAM policies permiten controla quien administra AWS RDS (through the RDS API)
      - Se puede usar user and password para login en la DB.
      - IAM based autentication puede ser usuado en MySQL y PostgreSQL.
  - RDS - IAM Authentication
    - Funciona con MySQL y PostgresSQL
    - Se maneja con autentication token que se obtiene con las RDS API Calls.
    - Auth token tiene una vida de 15 minutos
    - Beneficios
      - La comunicación de Red de entrada y salida está encriptada con SSL.
      - IAM para manejar los usuarios en forma centralizada.
      - Se puede dejar IAM Roles y EC2 profiles para integración sencilla.
  RDS AWS responsability:
   - No SSH access
   - No Manual DB patching
   - No manual OS patching
   - No way to audit the undelying instance.

Aurora Overview
 - Es una tecnología propietaria de AWS.
 - Postgres y MySQL son soportadas en AuroraDB
 - Aurora es AWS Cloud Oprimized - 5x performances mysql y 3x contra Postgres.
 - El almacenamiento crece en forma incremental de 10 Gb hasta 64 Tb.
 - Puede tener 15 replicas y el proceso es más rápido.
 - Failover en Aurora es instantáneo. Es HA nativo.
 - Aurora costa más que los RDS (20% más)
 Aurora HA y Read Scaling
 - 6 copias de los datos en 3 AZ:
   - 4 copias necesarias para escribir.
   - 3 copias de 6 necesita para leer.
   - Self healing with peer-to-peer replica
   - Storage striped accross 100s of volumes.
 - 1 Aurora toma la escrituras (master)
 - Failover automática en menos de 30 segundos.
 - Master + hasta 15 replicas de lectura.
 - Soportan Cross Region Replication.
 Aurora DB Cluster
 - Master es el único que escribe.
   Hay una Writer Endpoint apuntando a la master.
 - AutoScalling en la replicas de lectura.
   Reader Endpoint - Conection Load Balancing.
 Features de Aurora.
  - Automatic Failover
  - Backup and Recovery
  - Isolation and Security
  - Industry Compliance
  - Push-Button scaling
  - Automated patching with zero downtime
  - Advanced Monitoring
  - Routine maintenance
  - Backtrack: restore data at any point of time withour usign backups
 Aurora Security
  - Similar RDS
  - Encripción at Rest
  - Backup automaticos, snapshot y replicas son encriptadas.
  - Encripción on the flight SSL
  - Posibilidad de autenticar con IAM token
 Aurora Serverless
  - Autmated database instantiation and auto scaling base on actual usage.
  - Bueno para trabajos infrecuentes, intermittent o unpredictable.
  - No capacity planning needed.
  - Pay per second.
  - Proxy Fleet manejado por aurora.
  Sube y baja hasta 0 aurora.
 Global Aurora
  - Replicas de Aurora entre regiones
   - Para DR, simple de realizar.
  - Aurora Global Database
   - 1 Region primaria para read/write
   - Hasta 5 secundarias en read only, con lags menores al segundo.
   - Hasta 16 read replicas por región secundario.
   - Ayuda a decrece latency
   - RTO para promover hacia otra región es de menos de 1 minuto.
AWS ElastiCache Overview
 - ElastiCache is to get managed Redis or Memcached
 - Caches son base de datos en memoria con alta performance y baja latencia.
 - Ayuda a deducir la carga en la base de datos para lecturas intensivas.
 - Ayuda a que las aplicaciones sean Stateless
 - Write scaling usdin sharding
 - Read Scaling using Read Replicas
 - Multi AZ con Failover Capacity
 - AWS se ocupa del OS, patching, optimización, setup, configuración, monitoreo, failover recovery y backups,}
 Solution Architectura - DB Cache
  - App query primero a ElastiCache, si no está disponible, lo obtiene del RDS y lo guarda en el ElastiCache.
  - Cache hit alto, mejor.
  - Cache miss va a las agrega el ElastiCache.
  - Cache debe tener una estrategia de invalidación para que solo los datos más actuales son usados.
 Solution Architecure - User Session Store
  - La app graba la session en ElatiCache.
  - The users hits another instance of application.
  - La instancia devuelve los datos del usuario ya logueado.
 ElastiCache - Redis vs Memcached
  - Redis
    - Multi Az con auto failover.
    - Read replicas para escalar lecturas y ha
    - Durabilitiy data usando AOF presistence
    - Backup y restore features
  - Memcached
    - Mutli node para particionar los datos (sharding)
    - Non persistent
    - No backup
    - Multithreaded Architecture.
 ElastiCache - Cache security
  - All caches in ElastiCache:
    - Support SSL in flight encryption
    - Do not support IAM Authentication
    - IAM policies on ElastiCache solo son usada para la AWS API-level security
  - Redis Auth
    - Se setea un "passwrod/token" cuando se crea el cluter de Redis
    - En un nivel extra de seguridad (además del SG)
  - Memcached
    - Suporta SASL based autentication
 ElastiCache for Solution Architecture
  - Patrones para ElastiCache
     - Lazy Loading: Toda la data a leer es levantada en cache, está stale in cache.
     - Write through: Add or update data en cache cuando se escribe en la DB.
     - Session Store: Almacena temporalmente los datos de session en cache (usando TTL feature)
------------------------------------
###############################
------------------------------------

